#!/usr/local/bin/node
const _ = require('underscore');
const uglify = require('uglify-js');
const minifier = require('html-minifier');
const util = require('util');
const bliss = require('..');

const args = _.map(process.argv,_.identity);
const nodeExec = args.shift();
const nodeScript = args.shift();

var template = ast = code = undefined, compileStart = compileStop = 0;

compileStart = Date.now();
template = bliss.compileFile(args.shift(),{
  context: {
    _: _
  }
});
compileStop = Date.now();

formattedSource = uglify.uglify.gen_code(uglify.parser.parse(template.toString()),{
  beautify: true,
  indent_start: 0,
  indent_level: 2,
  space_colon: true
});

console.log(formattedSource);
console.log('/*')
console.log(' * generated by:','Bliss','(https://github.com/cstivers78/bliss)');
console.log(' * generated on:',new Date());
console.log(' * compile time:',compileStop-compileStart,'ms');
console.log(' */')